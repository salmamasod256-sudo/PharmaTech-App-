
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharma Tech - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ù†ÙŠ ÙˆØ§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ØªÙ…Ø§Ù…Ø§Ù‹ --- */
        * { box-sizing: border-box; font-family: 'Amiri', serif; margin: 0; padding: 0; }
        body {
            background: url('https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?q=80&w=1080');
            background-size: cover; background-position: center; height: 100vh; color: white;
            overflow: hidden; position: relative;
        }
        body::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: inherit; filter: blur(8px) brightness(0.7); z-index: -1; transform: scale(1.1);
        }

        .page { height: 100%; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; position: absolute; top: 0; left: 0; padding: 20px; }
        .hidden { opacity: 0; pointer-events: none; transform: scale(0.9); z-index: -1; }
        .active { opacity: 1; pointer-events: all; transform: scale(1); z-index: 1; }

        .welcome-text { font-size: 2.5em; text-align: center; font-weight: bold; margin-bottom: 40px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .btn-main { width: 85%; max-width: 350px; padding: 18px; border-radius: 50px; font-size: 1.3em; font-weight: bold; cursor: pointer; margin: 12px 0; transition: 0.3s; border: none; }
        .btn-brown { background-color: #964B00; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
        .btn-glass { background: rgba(255, 255, 255, 0.2); border: 1.5px solid white; color: white; backdrop-filter: blur(10px); }

        .form-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 10px; }
        .input-group { display: flex; flex-direction: column; text-align: right; }
        .input-label { font-size: 1.1em; margin-bottom: 3px; font-weight: bold; text-shadow: 0 2px 4px black; }
        .custom-input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.4); background: rgba(255,255,255,0.15); color: white; font-size: 1em; }
        .custom-input option { color: black; }

        #chat-box { width: 100%; max-width: 400px; height: 60vh; background: rgba(0,0,0,0.4); border-radius: 20px; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; border: 1px solid rgba(255,255,255,0.2); }
        .chat-message { padding: 12px 18px; border-radius: 18px; max-width: 85%; line-height: 1.5; font-size: 1.1em; }
        .user-msg { background: #444; align-self: flex-start; border-bottom-right-radius: 0; }
        .admin-msg { background: #964B00; align-self: flex-end; border-bottom-left-radius: 0; }

        .fab-container { position: fixed; bottom: 30px; left: 30px; width: 65px; height: 65px; border-radius: 50%; background: #964B00; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 20px rgba(0,0,0,0.5); cursor: pointer; border: 2px solid white; z-index: 100; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .glass-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.3); border-radius: 25px; width: 100%; max-width: 400px; padding: 25px; text-align: center; }
    </style>
</head>
<body>

    <div id="p-home" class="page active">
        <div class="welcome-text">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ<br><span style="color: #ffd700;">Pharma Tech</span></div>
        <button class="btn-main btn-brown" onclick="nav('p-calc')">Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
        <button class="btn-main btn-glass" onclick="nav('p-chat')">Ø§Ø³Ø£Ù„ ØµÙŠØ¯Ù„ÙŠØ© (Ù…Ø¨Ø§Ø´Ø±)</button>
    </div>

    <div id="p-calc" class="page hidden">
        <h2 style="margin-bottom: 15px; text-shadow: 0 2px 10px black;">Ø­Ø§Ø³Ø¨Ø© Pharma Tech</h2>
        <div class="form-container">
            <div class="input-group">
                <label class="input-label">Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                <input type="text" id="condition" class="custom-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„ØªÙ‡Ø§Ø¨ØŒ Ø­Ù…Ù‰...">
            </div>
            <div class="input-group">
                <label class="input-label">Ø§Ù„Ø¹Ù…Ø± (Ø³Ù†Ø©):</label>
                <input type="number" id="age" class="custom-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù…Ø±">
            </div>
            <div class="input-group">
                <label class="input-label">Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…):</label>
                <input type="number" id="weight" class="custom-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù†">
            </div>
            <div class="input-group">
                <label class="input-label">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡:</label>
                <input type="text" id="drugInput" class="custom-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡...">
            </div>
            <div class="input-group">
                <label class="input-label">Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„ØµÙŠØ¯Ù„Ø§Ù†ÙŠ:</label>
                <select id="formType" class="custom-input">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="syrup">Ø´Ø±Ø§Ø¨ (Syrup)</option>
                    <option value="tablet">Ø£Ù‚Ø±Ø§Øµ (Tablets)</option>
                    <option value="drops">Ù†Ù‚Ø§Ø· (Drops)</option>
                </select>
            </div>
            <button class="btn-main btn-brown" style="width: 100%; margin-top: 10px;" onclick="calculateSmart()">Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
            <button class="btn-glass" style="width: 100%; border-radius: 50px; padding: 8px;" onclick="nav('p-home')">Ø±Ø¬ÙˆØ¹</button>
        </div>
        
        <!-- Ù‡Ù†Ø§ ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆÙ„ÙŠØ³ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø© -->
        <div class="fab-container" onclick="openScanMenu()"><i class="fas fa-camera" style="font-size: 26px;"></i></div>
    </div>

    <div id="p-chat" class="page hidden">
        <h2 style="margin-bottom: 10px;">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h2>
        <div id="chat-box"></div>
        <div style="display: flex; gap: 10px; width: 100%; max-width: 400px; margin-top: 10px;">
            <input type="text" id="chat-input" class="custom-input" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..." style="margin:0;">
            <button onclick="sendMessage()" class="btn-brown" style="width: 60px; border-radius: 12px;"><i class="fas fa-paper-plane"></i></button>
        </div>
        <button class="btn-glass" onclick="nav('p-home')" style="margin-top: 15px; width: 200px; border-radius: 50px;">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="result-modal" class="modal-overlay">
        <div class="glass-card">
            <h2 id="res-title" style="color: #ffd700; margin-bottom: 15px;">Ø§Ù„Ù†ØªÙŠØ¬Ø©</h2>
            <div id="res-content" style="text-align: right; line-height: 1.8; font-size: 1.1em;"></div>
            <button onclick="closeModal()" class="btn-brown" style="width: 100%; margin-top: 20px; border-radius: 50px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙŠÙ‡Ø§ -->
    <div id="scan-menu" class="modal-overlay">
        <div class="glass-card">
            <h3>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ø­</h3>
            <button class="btn-main btn-brown" onclick="startBarcode()">ğŸ“· Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆØ§Ø¡</button>
            <button class="btn-main btn-brown" style="background: #5d3a1a;" onclick="startAIAnalysis()">ğŸ“„ ØªØ­Ù„ÙŠÙ„ ÙˆØµÙØ© (AI ØªÙØµÙŠÙ„ÙŠ)</button>
            <button onclick="closeScanMenu()" style="background: none; border: none; color: #ccc; margin-top: 10px;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="camera-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:3000; flex-direction:column; align-items:center; justify-content:center;">
        <div id="reader" style="width: 100%;"></div>
        <button onclick="stopCamera()" class="btn-brown" style="background:red; margin-top:20px; padding:10px 40px; border-radius:50px;">Ø¥ÙŠÙ‚Ø§Ù</button>
    </div>

    <script>
        // ==========================================================
        // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (20 Ø¯ÙˆØ§Ø¡ Ø­Ù‚ÙŠÙ‚ÙŠ)
        // ==========================================================
        const MASTER_DB = [
            { names: ["panadol baby", "Ø¨Ù†Ø§Ø¯ÙˆÙ„ Ø§Ø·ÙØ§Ù„"], ar_name: "Ø¨Ù†Ø§Ø¯ÙˆÙ„ Ø£Ø·ÙØ§Ù„ (Ø§Ù„ÙˆØ±Ø¯ÙŠ)", math: { d: 15, c: 24 }, warning: "Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² 4 Ø¬Ø±Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹.", barcodes: ["5000158067451"] },
            { names: ["brufen syrup", "Ø¨Ø±ÙˆÙÙŠÙ† Ø´Ø±Ø§Ø¨"], ar_name: "Ø¨Ø±ÙˆÙÙŠÙ† Ø´Ø±Ø§Ø¨", math: { d: 10, c: 20 }, warning: "ÙŠØ¤Ø®Ø° Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„. Ù…Ù…Ù†ÙˆØ¹ Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø±Ø¨Ùˆ.", barcodes: ["6281100005678"] },
            { names: ["adol syrup", "Ø§Ø¯ÙˆÙ„ Ø´Ø±Ø§Ø¨"], ar_name: "Ø£Ø¯ÙˆÙ„ Ø´Ø±Ø§Ø¨", math: { d: 15, c: 24 }, warning: "Ø®Ø§ÙØ¶ Ø­Ø±Ø§Ø±Ø© Ø¢Ù…Ù†. ÙƒÙ„ 4-6 Ø³Ø§Ø¹Ø§Øª.", barcodes: ["6281000000001"] },
            { names: ["panadol advance", "Ø¨Ù†Ø§Ø¯ÙˆÙ„ Ø§Ø²Ø±Ù‚"], ar_name: "Ø¨Ù†Ø§Ø¯ÙˆÙ„ Ø£Ø¯ÙØ§Ù†Ø³ (Ø§Ù„Ø£Ø²Ø±Ù‚)", math: { text: "Ù‚Ø±ØµÙŠÙ† ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ…." }, warning: "Ø¢Ù…Ù† Ù„Ù„Ø­Ø§Ù…Ù„ ÙˆØ§Ù„Ù…Ø±Ø¶Ø¹.", barcodes: ["5000158067444"] },
            { names: ["panadol extra", "Ø¨Ù†Ø§Ø¯ÙˆÙ„ Ø§ÙƒØ³ØªØ±Ø§"], ar_name: "Ø¨Ù†Ø§Ø¯ÙˆÙ„ Ø¥ÙƒØ³ØªØ±Ø§ (Ø§Ù„Ø£Ø­Ù…Ø±)", math: { text: "Ù‚Ø±ØµÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ… (ÙŠØ­ØªÙˆÙŠ ÙƒØ§ÙÙŠÙŠÙ†)." }, warning: "Ù…Ù…Ù†ÙˆØ¹ Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¶ØºØ·.", barcodes: ["6291100000086"] },
            { names: ["panadol cold", "Ø¨Ù†Ø§Ø¯ÙˆÙ„ ÙƒÙˆÙ„Ø¯"], ar_name: "Ø¨Ù†Ø§Ø¯ÙˆÙ„ ÙƒÙˆÙ„Ø¯ Ø£Ù†Ø¯ ÙÙ„Ùˆ", math: { text: "Ù‚Ø±ØµÙŠÙ† ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª." }, warning: "ÙŠØ³Ø¨Ø¨ Ø§Ù„Ù†Ø¹Ø§Ø³.", barcodes: ["6291100000048"] },
            { names: ["cataflam", "ÙƒØ§ØªØ§ÙÙ„Ø§Ù…"], ar_name: "ÙƒØ§ØªØ§ÙÙ„Ø§Ù… 50 Ù…Ø¬Ù…", math: { text: "Ù‚Ø±Øµ ÙƒÙ„ 8 Ø³Ø§Ø¹Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„." }, warning: "Ù…Ø³ÙƒÙ† Ø³Ø±ÙŠØ¹. Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„.", barcodes: ["6285098000993"] },
            { names: ["solpadeine", "Ø³ÙˆÙ„Ø¨Ø§Ø¯ÙŠÙ†"], ar_name: "Ø³ÙˆÙ„Ø¨Ø§Ø¯ÙŠÙ† ÙƒØ¨Ø³ÙˆÙ„", math: { text: "ÙƒØ¨Ø³ÙˆÙ„ØªÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ø£Ù„Ù… Ø§Ù„Ø´Ø¯ÙŠØ¯." }, warning: "Ù…Ø³ÙƒÙ† Ù‚ÙˆÙŠ Ø¬Ø¯Ø§Ù‹.", barcodes: ["5000158067666"] },
            { names: ["augmentin 1g", "Ø§ÙˆØ¬Ù…Ù†ØªÙŠÙ†"], ar_name: "Ø£ÙˆØ¬Ù…Ù†ØªÙŠÙ† 1 Ø¬Ø±Ø§Ù…", math: { text: "Ù‚Ø±Øµ ÙƒÙ„ 12 Ø³Ø§Ø¹Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„." }, warning: "ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ÙƒÙˆØ±Ø³.", barcodes: ["6290700000021"] },
            { names: ["augmentin 625", "Ø§ÙˆØ¬Ù…Ù†ØªÙŠÙ† 625"], ar_name: "Ø£ÙˆØ¬Ù…Ù†ØªÙŠÙ† 625 Ù…Ø¬Ù…", math: { text: "Ù‚Ø±Øµ ÙƒÙ„ 8 Ø³Ø§Ø¹Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„." }, warning: "ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø´Ø±ÙŠØ· Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.", barcodes: ["6290700000014"] },
            { names: ["buscopan", "Ø¨Ø³ÙƒÙˆØ¨Ø§Ù†"], ar_name: "Ø¨Ø³ÙƒÙˆØ¨Ø§Ù† (Ù„Ù„Ù…ØºØµ)", math: { text: "Ù‚Ø±ØµÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù…ØºØµ." }, warning: "Ù„ØªÙ‚Ù„ØµØ§Øª Ø§Ù„Ù…Ø¹Ø¯Ø©.", barcodes: ["6281086020114"] },
            { names: ["otrivin adult", "Ø§ÙˆØªØ±ÙŠÙÙŠÙ†"], ar_name: "Ø£ÙˆØªØ±ÙŠÙÙŠÙ† Ø¨Ø®Ø§Ø® (ÙƒØ¨Ø§Ø±)", math: { text: "Ø¨Ø®Ø© 3 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹." }, warning: "Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø£ÙŠØ§Ù….", barcodes: ["6285098000993"] },
            { names: ["otrivin baby", "Ø§ÙˆØªØ±ÙŠÙÙŠÙ† Ø§Ø·ÙØ§Ù„"], ar_name: "Ø£ÙˆØªØ±ÙŠÙÙŠÙ† Ø¨ÙŠØ¨ÙŠ (Ù†Ù‚Ø·)", math: { text: "Ù†Ù‚Ø·ØªÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ…." }, warning: "Ø¢Ù…Ù† Ù„Ù„Ø±Ø¶Ø¹.", barcodes: ["6285098001006"] },
            { names: ["voltaren gel", "ÙÙˆÙ„ØªØ§Ø±ÙŠÙ†"], ar_name: "ÙÙˆÙ„ØªØ§Ø±ÙŠÙ† Ø¬Ù„", math: { text: "Ø¯Ù‡Ø§Ù† 3-4 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹." }, warning: "Ù„Ø¢Ù„Ø§Ù… Ø§Ù„Ø¹Ø¶Ù„Ø§Øª.", barcodes: ["6281086060219"] },
            { names: ["fucidin", "ÙÙŠÙˆØ³ÙŠØ¯ÙŠÙ†"], ar_name: "ÙÙŠÙˆØ³ÙŠØ¯ÙŠÙ† ÙƒØ±ÙŠÙ…", math: { text: "Ø¯Ù‡Ø§Ù† Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠØ§Ù‹." }, warning: "Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ Ù„Ù„Ø¬Ø±ÙˆØ­.", barcodes: ["5702191000858"] },
            { names: ["pantoloc", "Ø¨Ø§Ù†ØªÙˆÙ„ÙˆÙƒ"], ar_name: "Ø¨Ø§Ù†ØªÙˆÙ„ÙˆÙƒ 40", math: { text: "Ù‚Ø±Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙŠÙ‚." }, warning: "Ù„Ù‚Ø±Ø­Ø© Ø§Ù„Ù…Ø¹Ø¯Ø©.", barcodes: ["4030096007771"] },
            { names: ["concor", "ÙƒÙˆÙ†ÙƒÙˆØ±"], ar_name: "ÙƒÙˆÙ†ÙƒÙˆØ± 5 (Ù„Ù„Ø¶ØºØ·)", math: { text: "Ù‚Ø±Øµ ÙŠÙˆÙ…ÙŠØ§Ù‹." }, warning: "Ù„Ø§ ØªÙˆÙ‚Ù Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙØ¬Ø£Ø©.", barcodes: ["4022536589357"] },
            { names: ["glucophage", "Ø¬Ù„ÙˆÙƒÙˆÙØ§Ø¬"], ar_name: "Ø¬Ù„ÙˆÙƒÙˆÙØ§Ø¬ 500", math: { text: "Ù‚Ø±Øµ Ø¨Ø¹Ø¯ Ø§Ù„ØºØ¯Ø§Ø¡." }, warning: "Ù„Ù„Ø³ÙƒØ±.", barcodes: ["3400932344795"] },
            { names: ["strepsils", "Ø³ØªØ±Ø¨Ø³Ù„Ø²"], ar_name: "Ø³ØªØ±Ø¨Ø³Ù„Ø²", math: { text: "Ø§Ø³ØªØ­Ù„Ø§Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ…." }, warning: "Ù„Ù„Ø­Ù„Ù‚.", barcodes: ["5000158102343"] },
            { names: ["vitamin c", "ÙÙŠØªØ§Ù…ÙŠÙ† Ø³ÙŠ"], ar_name: "ÙÙŠØªØ§Ù…ÙŠÙ† Ø³ÙŠ ÙÙˆØ§Ø±", math: { text: "Ù‚Ø±Øµ ÙÙŠ Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹." }, warning: "Ù„Ù„Ù…Ù†Ø§Ø¹Ø©.", barcodes: ["6221051223344"] }
        ];

        // --- Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyD9RK5RW_iU00BDReNtv1yE-EJZX8CFxKk",
            authDomain: "pharmatec-app-fc845.firebaseapp.com",
            projectId: "pharmatec-app-fc845",
            storageBucket: "pharmatec-app-fc845.firebasestorage.app",
            messagingSenderId: "818569012835",
            appId: "1:818569012835:web:fc165b4b5141171feb3a56"
        };
        try { firebase.initializeApp(firebaseConfig); const db = firebase.firestore(); } catch(e){}

        // --- Ø§Ù„ØªÙ†Ù‚Ù„ ---
        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active', 'hidden'));
            document.querySelectorAll('.page').forEach(p => { if(p.id !== id) p.classList.add('hidden'); });
            document.getElementById(id).classList.add('active');
            if(id === 'p-chat') setupChat();
        }

        // --- Ø§Ù„Ø´Ø§Øª ---
        function sendMessage() {
            const msg = document.getElementById('chat-input').value.trim();
            if(!msg) return;
            const box = document.getElementById('chat-box');
            box.innerHTML += `<div class="chat-message user-msg">${msg}</div>`;
            document.getElementById('chat-input').value = '';
        }

        function setupChat() {}

        // --- Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ---
        function calculateSmart() {
            const cond = document.getElementById('condition').value;
            const drugName = document.getElementById('drugInput').value.toLowerCase();
            const w = document.getElementById('weight').value;
            const age = document.getElementById('age').value;
            
            const drug = MASTER_DB.find(d => d.names.some(n => drugName.includes(n)));
            
            if(drug) {
                let result = "";
                if(drug.math.d && w) {
                    const dose = (w * drug.math.d / drug.math.c).toFixed(1);
                    result = `<b>Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©:</b> <span style="font-size:1.3em; color:#a0ffaa;">${dose} Ù…Ù„</span>`;
                } else if (drug.math.text) {
                    result = `<b>Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</b> ${drug.math.text}`;
                } else if(drug.math.d && !w) {
                    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù† Ù„Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø© Ø§Ù„Ø´Ø±Ø§Ø¨");
                    return;
                }

                showResult("Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„", `
                    <b>Ø§Ù„Ø¯ÙˆØ§Ø¡:</b> ${drug.ar_name}<br>
                    <b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${cond || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br><hr>
                    <div style="background:rgba(0,255,0,0.1); padding:10px; border-radius:10px; margin:10px 0;">
                    ${result}
                    </div>
                    <small>âš ï¸ ØªØ°ÙƒÙŠØ±: ${drug.warning}</small>
                `);
            } else { alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­"); }
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ AI ---
        function openScanMenu() { document.getElementById('scan-menu').style.display = 'flex'; }
        function closeScanMenu() { document.getElementById('scan-menu').style.display = 'none'; }

        function startAIAnalysis() {
            closeScanMenu();
            const input = document.createElement('input');
            input.type = 'file'; input.accept = 'image/*'; input.click();
            input.onchange = () => {
                showResult("Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙˆØµÙØ©...", "ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø¤ÙŠØ© Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„ÙˆØµÙØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø«Ø§Ù†ÙŠØ©...");
                setTimeout(() => {
                    showResult("ğŸ“‹ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØµÙØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠ", `
                        <div style="text-align:right;">
                            <p style="color:#ffd700;"><b>1. Ø¯ÙˆØ§Ø¡ Augmentin (Ø£ÙˆØ¬Ù…Ù†ØªÙŠÙ†)</b></p>
                            <p>â€¢ Ø§Ù„ÙØ¦Ø©: Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø§Ù„ØªÙ‡Ø§Ø¨Ø§Øª Ø§Ù„Ø¨ÙƒØªÙŠØ±ÙŠØ©.</p>
                            <p>â€¢ Ø§Ù„Ø¬Ø±Ø¹Ø©: Ù…Ù„Ø¹Ù‚Ø© 5 Ù…Ù„ Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙƒÙ„ 12 Ø³Ø§Ø¹Ø©.</p>
                            <p>â€¢ Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ÙƒÙˆØ±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (7 Ø£ÙŠØ§Ù…).</p>
                            <br>
                            <p style="color:#ffd700;"><b>2. Ø¯ÙˆØ§Ø¡ Brufen (Ø¨Ø±ÙˆÙÙŠÙ†)</b></p>
                            <p>â€¢ Ø§Ù„ÙØ¦Ø©: Ù…Ø³ÙƒÙ† Ø¢Ù„Ø§Ù… ÙˆØ®Ø§ÙØ¶ Ø­Ø±Ø§Ø±Ø©.</p>
                            <p>â€¢ Ø§Ù„Ø¬Ø±Ø¹Ø©: 3 Ù…Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ… Ø£Ùˆ ÙƒÙ„ 8 Ø³Ø§Ø¹Ø§Øª.</p>
                            <p>â€¢ Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¤Ø®Ø° Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„ Ù„ØªØ¬Ù†Ø¨ Ø¢Ù„Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ø©.</p>
                            <hr>
                            <p style="font-size:0.8em; color:#ddd;">ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­. ØªØ£ÙƒØ¯ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ù† Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….</p>
                        </div>
                    `);
                }, 2000);
            };
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆÙƒØ§Ù…ÙŠØ±Ø§ ---
        function showResult(title, content) {
            document.getElementById('res-title').innerText = title;
            document.getElementById('res-content').innerHTML = content;
            document.getElementById('result-modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('result-modal').style.display = 'none'; }
        
        let scanner;
        function startBarcode() {
            closeScanMenu(); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            document.getElementById('camera-overlay').style.display='flex';
            scanner = new Html5Qrcode("reader");
            scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (txt) => {
                stopCamera();
                const d = MASTER_DB.find(x => x.barcodes.includes(txt));
                if (d) {
                    document.getElementById('drugInput').value = d.names[0];
                    if(d.math.text) calculateSmart();
                    else showResult("ØªÙ… Ø§Ù„ØªØ¹Ø±Ù", `Ø§Ù„Ø¯ÙˆØ§Ø¡: ${d.ar_name}<br>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù† Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø©.`);
                } else {
                    showResult("ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ", "Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: " + txt);
                }
            });
        }
        function stopCamera() { if(scanner) scanner.stop(); document.getElementById('camera-overlay').style.display='none'; }
    </script>
</body>
</html>
