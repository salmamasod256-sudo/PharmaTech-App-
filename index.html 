<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Pharma Tech App</title>

    <link rel="stylesheet" href="style.css">

    <link rel="manifest" href="manifest.json">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PharmaTech">
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/html5-qrcode"></script>
    
</head>
<body>

    <div class="scanner-overlay" id="scannerOverlay" style="display: none;">
        <div class="scanner-content">
            <div id="qr-reader-content" style="width: 100%;">
                <p style="text-align: center; padding: 20px;">
                    <strong>قارئ الباركود/OCR (تحليل الوصفات)</strong><br>
                    اضغط على زر "مسح رمز QR/باركود" لتفعيل الكاميرا.
                </p>
            </div>
            <p style="margin-bottom: 15px; margin-top: 20px;">اختر وضع المسح:</p>
            <button class="scanner-btn" onclick="startQRScan()">مسح رمز QR/باركود</button>
            <button class="scanner-btn" onclick="startOCRScan()">مسح وصفة طبية (OCR)</button>
            <button class="scanner-btn" style="background: #8b4513;" onclick="hideScanner()">إغلاق والعودة للنموذج</button>
        </div>
    </div>
    
    <div id="page-index">
        <div class="content">
            <h1>مرحبًا بك في <span>Pharma Tech</span></h1>
            <div class="buttons">
                <button onclick="changePage('form')">دخول إلى التطبيق</button>
                <button class="chat" onclick="alert('وظيفة الدردشة قيد التطوير.');">اسأل صيدلية</button>
            </div>
        </div>
    </div>
    
    <div id="page-form" style="display: none;">
        <h2>Pharma Tech</h2>
        <form onsubmit="showResult(); return false;"> 
            <label>اسم الحالة:</label>
            <input type="text" id="caseName" placeholder="مثلاً: حمى، صداع، التهاب..." required>
            
            <label>أدخل عمرك (سنة):</label>
            <input type="number" id="age" placeholder="اكتب عمرك" required>
            
            <label>أدخل وزنك (كغ):</label>
            <input type="number" id="weight" placeholder="اكتب وزنك" required>
            
            <label>اسم الدواء (اكتب جزء من الاسم):</label>
            <input type="text" id="drugName" placeholder="مثلاً: paracetamol, ibuprofen..." required>
            
            <label>الشكل الصيدلاني:</label>
            <select id="form" required>
                <option value="" disabled selected>اختر شكل الدواء</option>
                <option value="قرص (Tablet)">قرص (Tablet)</option>
                <option value="كبسولة (Capsule)">كبسولة (Capsule)</option>
                <option value="حقن (Injection)">حقن (Injection)</option>
                <option value="شراب/معلق (Syrup/Suspension)">شراب/معلق (Syrup/Suspension)</option>
                <option value="استنشاق (Inhalation)">استنشاق (Inhalation)</option>
                <option value="تحميلة (Suppository)">تحميلة (Suppository)</option>
            </select>
            
            <button type="submit" class="submit">النتيجة</button>
        </form>
        
        <div class="camera-btn" onclick="showScanner()" title="مسح وصفة طبية (QR/صورة)">
            <svg class="camera-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
        </div>
    </div>
    
    <div id="page-result" style="display: none;">
        <div class="result-card">
            <div class="welcome-header">جارٍ تحميل البيانات...</div>
            <div class="drug-name"></div>
            <ul></ul>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn" onclick="window.print()" title="اطبع النتيجة">
                <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6c-1.1 0-2 .9-2 2v2h16V4c0-1.1-.9-2-2-2z"/></svg>
                <span>PDF/طباعة</span>
            </button>
            <button class="action-btn" onclick="saveData()" title="حفظ البيانات">
                <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
                <span>حفظ المعلومات</span>
            </button>
            <button class="action-btn" onclick="changePage('index')" title="الواجهة الرئيسية">
                <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <span>واجهة البداية</span>
            </button>
            <button class="action-btn" onclick="changePage('form')" title="إعادة تعبئة النموذج">
                <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26l1.41-1.41C6.34 14.84 6 13.48 6 12c0-3.31 2.69-6 6-6zm6 6c0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26l-1.41 1.41C17.66 9.16 18 10.52 18 12z"/></svg>
                <span>إعادة النموذج</span>
            </button>
        </div>
    </div>
    
    <script src="script.js"></script>
    
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          // تأكد من أن مسار الملف service-worker.js صحيح (في نفس المجلد)
          navigator.serviceWorker.register('/service-worker.js') 
            .then(reg => console.log('SW registered!'))
            .catch(err => console.log('SW registration failed: ', err));
        });
      }
    </script>
</body>
</html>
